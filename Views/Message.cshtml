@using Orchard.Settings;
@using Lombiq.SmartNotifications.Models;
@using Orchard.ContentManagement;
@using Piedone.HelpfulLibraries.Utilities;
@{
    Script.Require("jQuery").AtHead();
    Style.Include("lombiq-smartnotifications-style.css").AtHead();
    var siteService = WorkContext.Resolve<ISiteService>();
    var settings = siteService.GetSiteSettings().As<SmartNotificationsPart>();
    string message = Model.Message.ToString();
    var isClosable = settings.IsClosable || message.Contains("\\CLO:\\");
    var isFading = settings.IsFading || message.Contains("\\FAD:\\"); 
}
@if (isClosable && isFading)
{
    <div class="message message-@Model.Type">@Html.Raw(Html.Encode(Model.Message).Replace("\n", "<br />").Replace("\\CLO:\\","").Replace("\\FAD:\\",""))<span id='closeMessage'>&#10006;</span></div>
}
else
{
    if (isClosable)
    {
        <div class="message message-@Model.Type">@Html.Raw(Html.Encode(Model.Message).Replace("\n", "<br />").Replace("\\CLO:\\", "").Replace("\\FAD:\\", ""))<span id='closeMessage'>&#10006;</span></div>
    }
    else if (isFading)
    {
        <div class="message message-@Model.Type">@Html.Raw(Html.Encode(Model.Message).Replace("\n", "<br />").Replace("\\CLO:\\", "").Replace("\\FAD:\\", ""))</div>
    }
    else if (!settings.IsFading && !settings.IsClosable)
    {
        <div class="message message-@Model.Type">@Html.Raw(Html.Encode(Model.Message).Replace("\n", "<br />"))</div>
    }
}
@if(this.WasNotDisplayed("messageJS"))
{
<script type="text/javascript">
(function ($) {
    $(function () {
        $(".message > span").click(function () {
            $(this).parent().hide();
        });
        @if(settings.IsFading) {
            <text>setTimeout(function () { $('.message').fadeOut(2000) }, 5000);</text>
        }
    });
})(jQuery);
</script>
}